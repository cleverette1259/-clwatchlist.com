<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CL Vault</title>
  
  <link rel="icon" type="image/x-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAFGmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNy4yLWMwMDAgNzkuMWI3OGI3YSwgMjAyMi8wNi8xMy0yMjowMTo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6Q0I3RjI5Q0VBRDVCMTFFRThDODREMDkxNzZBNTcwMDkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6Q0I3RjI5Q0RBRDVCMTFFRThDODREMDkxNzZBNTcwMDkiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NkExN0IxRDZBRDVCMTFFRThDODREMDkxNzZBNTcwMDkiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NkExN0IxRDdBRDVCMTFFRThDODREMDkxNzZBNTcwMDkiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InciPz50S/pYAAAEZ0lEQVRYhe2XfUzUdRzHP98f98edB3ceIodHeSjHQRAnZzBeYInisGBr6GypyWpt5WptbbWttVr90Zq19UfWltZqay7NoXNoYigigp7p8YhHIApEx6HDcefhjuP3x6+fKAcHdyAd7Xf7fX6vP97v+3m+n/f7fD77A7S3X8tL3v8fAG6O7OxsUqnUMU8mk1fF4/E/XwCv8vPzSU9PJ5FInPMEAgHm5+eRZRm5+T2fT0uShKqq9Pb2MjY2dk7g9Xp/UACvFosFq9WKLMscPHiQSCRCUlIS6enpeDwenE4nkUiEUCiEKIqoqkoaY3x8nM7OTnp6euju7mZ8fPw7z3MAnidAOBwmKysLq9WKJElIkkRWVhbBYBCTyYTVaiUQCBAMBvF4PKTT6SSTSaLRKF1dXTgcDtrb2+no6GBiYuJr6/MAnicAn89HSUkJVVVVFBQUYLPZSEtLw2g0Isf/uVwupOnpaUZGRuju7sbhcNDa2srk5OR3pucBPE+AxMRE8vLyMBgMeDwevF4vJSUlFBcXk5qaSjAYRFEUFEUhlUoxNTVFW1sbbW1tdHd3Mzk5id/vfw54ngDZ2dmIokgsFmNkZIRAIIDP56Ourg6Px4PBYMCS+O/3+5mcnKSurq6qqumNjIzc8DyA5wnAn08GgwFFURgeHiYSiSAn/hcXF1NTU4Pf78dkMiHLMrIsMzU1RWtrK62trXR2dtLT04Pf738OeJ4AisPhQB6P0dFReSIRCPl8PoqLi8nMzER+GZfLRWtrK62trXR3dzM5OYnf738OeJ4AarXaj6qqSJKEEI8jHA5TXFxMdXU18XgcRVEYHh6mvb2dtvZ2enp6mJycxO/3Pwc8T4BvGhoaDmVmZp5IJpPHX63VarXabDavKIqHqqq7Ghoa2v5qAnp7exkdHWVxcRFFUfB6vVRXV5OdnU0oFCISidDb20tnZye9vb1MTk7idrt3+f3+9S98v8f3uVwuOjo6mJqaYmFhgfHxccbGxhgdHWVkZIRQKMT8/DylpaXU1dWRkpJCKBQinU7T3d2N3e7A7rAzPj7OwsIC4XCYvr4+7HY7Lpfrm/HxcTo7O5menub999f+7u964uLiSElJ4dVXf+Lll/8kPj4eXdex2WxYrVba29t5+eUX+fbb7zh06DDnz/9FWdkZ9PqY77yvL/1pI6IokkjEeeONKqxWKz6fj+rqar799jsOHTrMpUtVpFIpvv/+R0SR/pAniiImkwm9Xo/JZKKiogK/309NTQ2XLlWRTqf5/fcfKS09gyRJ9/T3/X4vXq+X9vY7jIyMkEwm8Xq9HD9+gp9+uozH4+HSpX9wOp0AtLS04Xa7UauvHwNJSUnodDpKSkoYGBiguroai8XChQtXcLvdAFitp5ifXyAUCvHzz9eYmZlFkqR7+vszv8/lclFWVkZycjKqqpJKpWhra8NisTB9fIbx8TGmp6fwer10dnYCUFx8vHlqavpT+fIu+eP3+1EUBVVVUVUVURTZuHGTVqfTsWvXbpqamuju7r7mef4Z8D8+S4F80M/l+wAAAABJRU5ErkJggg==">

  <style>
    :root { --accent-hue: 0; }
    * { box-sizing: border-box; }
    body { font-family: 'Segoe UI', sans-serif; margin: 0; height: 100vh; color: #fff; overflow: hidden; background: #000; display: flex; }

    /* --- Custom Scrollbars --- */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #000; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: hsla(var(--accent-hue), 100%, 50%, 0.5); }

    /* --- Buttons & Badges --- */
    .mist-btn { 
      background: hsla(var(--accent-hue), 100%, 50%, 0.1); 
      color: #fff; border: 1px solid hsla(var(--accent-hue), 100%, 50%, 0.3); 
      cursor: pointer; font-size: 10px; padding: 10px; text-transform: uppercase; transition: 0.2s; 
    }
    .mist-btn:hover { 
      background: hsla(var(--accent-hue), 100%, 50%, 0.2); 
      border-color: hsla(var(--accent-hue), 100%, 50%, 1); 
    }

    .new-badge {
      font-size: 7px; background: hsla(var(--accent-hue), 100%, 50%, 1);
      color: #000; padding: 1px 4px; border-radius: 2px; font-weight: 900;
      margin-left: 8px; box-shadow: 0 0 8px hsla(var(--accent-hue), 100%, 50%, 0.5);
    }

    /* --- Sidebars --- */
    #sidebar-left { width: 60px; background: rgba(0,0,0,0.6); backdrop-filter: blur(20px); border-right: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; align-items: center; padding: 20px 0; gap: 20px; z-index: 500; }
    #sidebar-right { width: 260px; background: rgba(0,0,0,0.85); backdrop-filter: blur(30px); border-left: 1px solid rgba(255,255,255,0.1); padding: 20px 15px; display: flex; flex-direction: column; gap: 25px; overflow-y: auto; z-index: 400; }
    
    #url-input { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #fff; padding: 12px; font-size: 11px; outline: none; width: 100%; transition: 0.3s; }
    #url-input:focus { border-color: hsla(var(--accent-hue), 100%, 50%, 0.8); }

    /* --- Grid & Cards --- */
    #main-content { flex: 1; padding: 40px; overflow-y: auto; position: relative; }
    #video-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap:20px; }
    .card { background: rgba(255,255,255,0.03); padding: 15px; border: 1px solid rgba(255,255,255,0.08); position: relative; }
    .card-dots { position: absolute; top: 4px; right: 2px; cursor: pointer; opacity: 0.4; font-size: 14px; z-index: 10; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; }

    /* --- Context Menus --- */
    .context-menu { position: absolute; background: #111; border: 1px solid #333; z-index: 3000; display: none; width: 160px; border-radius: 4px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    .menu-item { position: relative; padding: 10px; font-size: 9px; text-transform: uppercase; cursor: pointer; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; }
    .menu-item:hover { background: hsla(var(--accent-hue), 100%, 50%, 0.2); }
    .submenu-inner { position: absolute; right: 100%; top: 0; background: #111; border: 1px solid #333; width: 150px; display: none; z-index: 3100; max-height: 200px; overflow-y: auto; }
    .menu-item:hover > .submenu-inner { display: block; }

    /* --- Folders --- */
    .folder-header { padding: 12px 0; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.05); }
    .folder-name-group { cursor: pointer; display: flex; align-items: center; gap: 10px; flex: 1; overflow: hidden; }
    .folder-content { display: none; padding: 10px 0; }
    .folder-content.open { display: block; }

    /* --- Lock Screen --- */
    #lock-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; background: #050505; transition: 0.8s; }
    #lock-screen.hidden { opacity: 0; pointer-events: none; }
    #password { background:#000; border:1px solid rgba(255,255,255,0.1); color:#fff; padding: 12px; text-align:center; outline:none; margin-bottom:10px; width:220px; z-index: 10001; }
    
    .bg-wrapper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; pointer-events: none; }
    video.bg-video, .bg-img-div { width: 100%; height: 100%; object-fit: cover; position: absolute; top:0; left:0; display: none; opacity: 0; transition: opacity 1s; }
    .bg-visible { opacity: 1 !important; display: block !important; }
  </style>
</head>
<body onclick="closeAllMenus()">

<div id="lock-screen">
  <div class="bg-wrapper">
    <video id="lock-bg-video" class="bg-video" autoplay muted loop playsinline></video>
    <div id="lock-bg-img" class="bg-img-div"></div>
  </div>
  <input type="password" id="password" placeholder="ACCESS KEY" autocomplete="off">
  <button class="mist-btn" id="loginBtn" style="width:220px;">Unlock</button>
</div>

<div id="sidebar-left">
  <div style="cursor: pointer; font-size: 24px; opacity: 0.5;" onclick="toggleSidebarMenu(event)">⋮</div>
  <div id="sidebar-context" class="context-menu" style="left: 65px; top: 20px; padding: 25px 15px; width: auto;" onclick="event.stopPropagation()">
    <input type="range" id="hue-slider" min="0" max="360" value="0" style="appearance: none; width: 120px; height: 4px; background: #333; transform: rotate(-90deg); cursor: pointer; margin: 60px 0;">
  </div>
  <button class="mist-btn" onclick="triggerBG()" style="width:40px; font-size:8px;">BG</button>
</div>

<div id="main-content">
  <div class="bg-wrapper">
    <video id="bg-video" class="bg-video" autoplay muted loop playsinline></video>
    <div id="bg-img" class="bg-img-div"></div>
  </div>
  <div id="video-grid"></div>
</div>

<div id="sidebar-right">
  <div class="input-section" style="display:flex; flex-direction:column; gap:8px;">
    <h3 style="font-size: 8px; opacity: 0.3; letter-spacing: 2px;">PASTE URL</h3>
    <input type="text" id="url-input" placeholder="URL...">
    <button class="mist-btn" id="addCardBtn">Add to Vault</button>
  </div>
  
  <div style="border-top:1px solid rgba(255,255,255,0.1); padding-top:20px;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
      <h3 style="font-size: 8px; opacity: 0.3;">FOLDERS</h3>
      <button class="mist-btn" onclick="createNewFolder()" style="padding:4px 6px; font-size: 8px;">+ NEW</button>
    </div>
    <div id="folder-tab-list"></div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const PASS = 'Prince2beast';
    let library = JSON.parse(localStorage.getItem('cl_vF_links')) || [];
    let folders = JSON.parse(localStorage.getItem('cl_vF_folders')) || [];
    let openFolders = JSON.parse(localStorage.getItem('cl_vF_openFolders')) || [];
    let db;
    let currentURL = null;

    const dbReq = indexedDB.open("VaultMediaDB", 4);
    dbReq.onupgradeneeded = (e) => {
        let database = e.target.result;
        if (!database.objectStoreNames.contains("media")) database.createObjectStore("media");
    };
    dbReq.onsuccess = (e) => { db = e.target.result; init(); };

    function init() {
        updateHue(localStorage.getItem('vault_hue') || 0);
        const tx = db.transaction("media", "readonly");
        tx.objectStore("media").get("currentBG").onsuccess = (e) => {
            if (e.target.result) applyBG(e.target.result.data, e.target.result.type === 'v');
        };
        render();
        setTimeout(() => document.getElementById('password').focus(), 500);
    }

    function applyBG(data, isVid) {
        const vids = [document.getElementById('bg-video'), document.getElementById('lock-bg-video')];
        const imgs = [document.getElementById('bg-img'), document.getElementById('lock-bg-img')];
        if (currentURL) URL.revokeObjectURL(currentURL);
        vids.forEach(v => { v.style.display='none'; v.classList.remove('bg-visible'); v.src=""; });
        imgs.forEach(i => { i.style.display='none'; i.classList.remove('bg-visible'); i.style.backgroundImage=""; });
        const src = (data instanceof Blob) ? (currentURL = URL.createObjectURL(data)) : data;
        if (isVid) {
            vids.forEach(v => { v.src=src; v.style.display='block'; v.classList.add('bg-visible'); v.load(); v.play().catch(()=>{}); });
        } else {
            imgs.forEach(i => { i.style.backgroundImage=`url(${src})`; i.style.display='block'; i.classList.add('bg-visible'); });
        }
    }

    window.triggerBG = () => {
        const f = document.createElement('input'); f.type='file'; f.accept='image/*,video/*';
        f.onchange = (e) => {
            const file = e.target.files[0]; if(!file) return;
            const isV = file.type.includes('video');
            const tx = db.transaction("media", "readwrite");
            tx.objectStore("media").put({ data: file, type: isV ? 'v' : 'i' }, "currentBG");
            tx.oncomplete = () => applyBG(file, isV);
        };
        f.click();
    };

    const passIn = document.getElementById('password');
    passIn.addEventListener('keypress', (e) => { if(e.key==='Enter') login(); });
    document.getElementById('loginBtn').onclick = login;

    function login() {
        if(passIn.value === PASS) {
            document.getElementById('lock-screen').classList.add('hidden');
            const mainVid = document.getElementById('bg-video');
            if(mainVid) mainVid.play().catch(()=>{});
        } else {
            passIn.style.borderColor = "red"; passIn.value = "";
            setTimeout(() => passIn.style.borderColor = "rgba(255,255,255,0.1)", 1000);
        }
    }

    function updateHue(h) { document.documentElement.style.setProperty('--accent-hue', h); localStorage.setItem('vault_hue', h); }
    document.getElementById('hue-slider').oninput = (e) => updateHue(e.target.value);

    window.toggleSidebarMenu = (e) => { e.stopPropagation(); const m = document.getElementById('sidebar-context'); m.style.display = (m.style.display === 'block') ? 'none' : 'block'; };
    window.closeAllMenus = () => document.querySelectorAll('.context-menu').forEach(m => m.style.display = 'none');
    window.toggleMenu = (e, id) => { e.stopPropagation(); const m = document.getElementById(id); const s = m.style.display === 'block'; closeAllMenus(); if(!s) m.style.display = 'block'; };
    
    window.toggleFolder = (name) => {
        openFolders = openFolders.includes(name) ? openFolders.filter(f => f !== name) : [...openFolders, name];
        localStorage.setItem('cl_vF_openFolders', JSON.stringify(openFolders));
        render();
    };

    function render() {
        const grid = document.getElementById('video-grid');
        grid.innerHTML = '';
        library.filter(i => !i.folder).forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            const fSub = folders.map(f => `<div class="menu-item" onclick="moveItem(${item.id}, '${f.name}')">${f.name}</div>`).join('');
            card.innerHTML = `
                <div class="card-dots" onclick="toggleMenu(event, 'm-${item.id}')">⋮</div>
                <div id="m-${item.id}" class="context-menu" style="top:25px; right:5px;">
                    <div class="menu-item" onclick="renameItem(${item.id})">Rename</div>
                    <div class="menu-item">Move To <span>▶</span><div class="submenu-inner">${fSub || 'No Folders'}</div></div>
                    <div class="menu-item" style="color:red;" onclick="deleteItem(${item.id})">Delete</div>
                </div>
                <div style="aspect-ratio:16/9; background:#111; margin-bottom:12px; overflow:hidden;"><img src="${item.thumb}" style="width:100%; height:100%; object-fit:cover;" onerror="this.src='https://via.placeholder.com/320x180/111/fff?text=Link'"></div>
                <div style="font-size:10px; font-weight:bold; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; margin-bottom:10px;">${item.label}</div>
                <button class="mist-btn" style="width:100%;" onclick="window.open('${item.url}','_blank')">LAUNCH</button>
            `;
            grid.appendChild(card);
        });

        const tabList = document.getElementById('folder-tab-list');
        tabList.innerHTML = '';
        folders.forEach(f => {
            const isOpen = openFolders.includes(f.name);
            const container = document.createElement('div');
            const safeName = f.name.replace(/\s+/g, '-');
            container.innerHTML = `
                <div class="folder-header">
                    <div class="folder-name-group" onclick="toggleFolder('${f.name}')">
                        <span style="font-size:8px; opacity:0.3;">${isOpen ? '▼' : '▶'}</span>
                        <span style="font-size:11px; font-weight:600; text-transform:uppercase;">${f.name}</span>
                    </div>
                    <div class="card-dots" style="position:relative;" onclick="toggleMenu(event, 'f-opt-${safeName}')">⋮</div>
                    <div id="f-opt-${safeName}" class="context-menu" style="right:0; margin-top:25px;">
                        <div class="menu-item" onclick="renameFolder('${f.name}')">Rename</div>
                        <div class="menu-item" style="color:red;" onclick="deleteFolder('${f.name}')">Delete</div>
                    </div>
                </div>
                <div class="folder-content ${isOpen ? 'open' : ''}">${renderFolderLinks(f.name)}</div>
            `;
            tabList.appendChild(container);
        });
    }

    function renderFolderLinks(fName) {
        const links = library.filter(i => i.folder === fName);
        if(!links.length) return '<div style="font-size:8px; opacity:0.2; text-align:center;">Empty</div>';
        const latestId = links.length ? links.reduce((p, c) => (p.movedAt > c.movedAt) ? p : c).id : null;
        return links.map(l => {
            const isFresh = (Date.now() - l.movedAt < 18000000) && l.id === latestId;
            return `
                <div class="folder-link-item">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="font-size:9px; font-weight:bold; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; max-width:140px;">
                            ${l.label}${isFresh ? '<span class="new-badge">NEW</span>' : ''}
                        </span>
                        <div class="card-dots" style="position:relative;" onclick="toggleMenu(event, 'f-m-${l.id}')">⋮</div>
                    </div>
                    <div id="f-m-${l.id}" class="context-menu" style="right:10px; margin-top:5px;">
                        <div class="menu-item" onclick="window.open('${l.url}','_blank')">Open</div>
                        <div class="menu-item" onclick="renameItem(${l.id})">Rename</div>
                        <div class="menu-item" onclick="moveItem(${l.id}, '')">Remove Folder</div>
                        <div class="menu-item" style="color:red;" onclick="deleteItem(${l.id})">Delete</div>
                    </div>
                </div>
            `;
        }).join('');
    }

    window.moveItem = (id, fName) => { const idx = library.findIndex(i => i.id === id); if(idx !== -1) { library[idx].folder = fName; library[idx].movedAt = Date.now(); sync(); } };
    window.renameFolder = (oldN) => { const newN = prompt("New Name:", oldN); if(newN && newN !== oldN) { folders = folders.map(f => f.name === oldN ? {name: newN} : f); library.forEach(i => { if(i.folder === oldN) i.folder = newN; }); sync(); } };
    window.renameItem = (id) => { const i = library.find(item => item.id === id); const n = prompt("Rename Link:", i.label); if(n) { i.label = n; sync(); } };
    window.deleteFolder = (n) => { folders = folders.filter(f => f.name !== n); library.forEach(i => {if(i.folder===n) i.folder='';}); sync(); };
    window.createNewFolder = () => { const n = prompt("Folder Name:"); if(n) { folders.push({name:n}); sync(); } };
    window.deleteItem = (id) => { library = library.filter(i => i.id !== id); sync(); };
    function sync() { localStorage.setItem('cl_vF_links', JSON.stringify(library)); localStorage.setItem('cl_vF_folders', JSON.stringify(folders)); render(); }

    const addBtn = document.getElementById('addCardBtn'); const urlIn = document.getElementById('url-input');
    urlIn.addEventListener('keypress', (e) => { if(e.key === 'Enter') addBtn.click(); });

    addBtn.onclick = async () => {
        const val = urlIn.value.trim(); if(!val) return;
        const url = val.startsWith('http') ? val : `https://${val}`;
        addBtn.innerText = 'FETCHING...'; addBtn.disabled = true;
        try {
            const res = await fetch(`https://api.microlink.io?url=${encodeURIComponent(url)}`);
            const data = await res.json();
            library.unshift({ id: Date.now(), label: data.data.title || url, url: url, thumb: data.data.image?.url || '', folder: "", movedAt: 0 });
            sync();
        } catch (e) { library.unshift({ id: Date.now(), label: url, url: url, thumb: '', folder: "", movedAt: 0 }); sync(); }
        addBtn.innerText = 'ADD TO VAULT'; addBtn.disabled = false; urlIn.value = '';
    };
});
</script>
</body>
</html>
